<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=victor+mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"xychen5.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.10.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12,"width":300},"copycode":false,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":{"changyan":{"text":"Load Disqus","order":-2},"gitalk":{"order":-1}}},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"zoomIn","post_header":"zoomIn","post_body":"zoomIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

  <meta name="description" content="Freiheit Weht">
<meta property="og:type" content="website">
<meta property="og:title" content="LuftBallon">
<meta property="og:url" content="https://xychen5.github.io/page/5/index.html">
<meta property="og:site_name" content="LuftBallon">
<meta property="og:description" content="Freiheit Weht">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="xychen5">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://xychen5.github.io/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>LuftBallon</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">LuftBallon</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-arrow-right fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>Commonweal 404</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="xychen5"
      src="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
  <p class="site-author-name" itemprop="name">xychen5</p>
  <div class="site-description" itemprop="description">Freiheit Weht</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">69</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/xychen5?tab=repositories" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xychen5?tab&#x3D;repositories" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:cxynash5@gmail.com" title="E-Mail → mailto:cxynash5@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://xychen5.github.io/2021/11/15/algoStronglyConnectedComponents/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
      <meta itemprop="name" content="xychen5">
      <meta itemprop="description" content="Freiheit Weht">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuftBallon">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/15/algoStronglyConnectedComponents/" class="post-title-link" itemprop="url">stronglyConnectedComponents 强联通分量求法 - kosaraju & tarjan & gabow & 并查集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-11-15 11:13:12" itemprop="dateCreated datePublished" datetime="2021-11-15T11:13:12+08:00">2021-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-03 19:50:26" itemprop="dateModified" datetime="2023-08-03T19:50:26+08:00">2023-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-强联通分量解释"><a href="#1-强联通分量解释" class="headerlink" title="1 强联通分量解释"></a>1 强联通分量解释</h2><p>SCC(stronglyConnectedComponents) 对于G(v, e)的一个子图中，其任何两个顶点都存在一个path相互到达;</p>
<h2 id="2-图的拓扑排序"><a href="#2-图的拓扑排序" class="headerlink" title="2 图的拓扑排序"></a>2 <a href="yikanggao.com/blog/2016/12/%E5%9B%BE%E7%9A%84%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F.html">图的拓扑排序</a></h2><p>拓扑排序的核心思路还是利用深度优先搜索，排序的基本思想为深度优先搜索正好只会访问每个顶点一次，如果将dfs的参数顶点保存在一个数据结构中，遍历这个数据结构就能访问图中的所有顶点，而遍历的顺序取决于这个数据结构的性质以及是在递归调用之前还是递归调用之后保存。</p>
<ul>
<li>1 前序：　在递归调用之前将顶点加入队列　—- pre()方法</li>
<li>2 后序：　在递归调用之后将顶点加入队列　—- post()方法</li>
<li>3 逆后序： 在递归调用之后将顶点压入栈 —- reversePost()方法<br>这里给出一个逆后序的例子：<br><img src="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/%E5%BC%BA%E8%81%94%E9%80%9A%E5%88%86%E9%87%8F.77kjmz93ddc0.png" alt="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/强联通分量.77kjmz93ddc0.png"><br>其逆后序得到的一个栈为：(右侧为栈顶，代表最晚完成访问的节点) <strong>6 4 2 5 3 1</strong></li>
</ul>
<p>逆后序获得代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DepthFirstOrder</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">boolean</span>[] marked;</span><br><span class="line">	<span class="keyword">private</span> Queue&lt;Integer&gt; pre;			<span class="comment">//所有顶点的前序排列</span></span><br><span class="line">	<span class="keyword">private</span> Queue&lt;Integer&gt; post;		<span class="comment">//所有顶点的后序排列</span></span><br><span class="line">	<span class="keyword">private</span> Stack&lt;Integer&gt; reversePost;	<span class="comment">//所有顶点的逆后序排列</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">DepthFirstOrder</span><span class="params">(Digraph G)</span>&#123;</span><br><span class="line">		pre = <span class="keyword">new</span> <span class="title class_">Queue</span>&lt;Integer&gt;();</span><br><span class="line">		post = <span class="keyword">new</span> <span class="title class_">Queue</span>&lt;Integer&gt;();</span><br><span class="line">		reversePost = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;Integer&gt;();</span><br><span class="line">		marked = <span class="keyword">new</span> <span class="title class_">boolean</span>[G.V()];</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span><span class="number">0</span>;v&lt;G.V();v++)</span><br><span class="line">			<span class="keyword">if</span>(!marked[v]) dfs(G,v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(Digraph G,<span class="type">int</span> v)</span>&#123;</span><br><span class="line">		pre.enqueue(v);</span><br><span class="line"></span><br><span class="line">		marked[v] = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> w:G.adj(v))</span><br><span class="line">			<span class="keyword">if</span>(!marked[w])</span><br><span class="line">				dfs(G,w);</span><br><span class="line"></span><br><span class="line">		post.enqueue(v);</span><br><span class="line">		reversePost.push(v);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Iterable&lt;Integer&gt; <span class="title function_">pre</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pre;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Iterable&lt;Integer&gt; <span class="title function_">post</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> post;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Iterable&lt;Integer&gt; <span class="title function_">reversePost</span><span class="params">()</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> reversePost;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-求解算法"><a href="#3-求解算法" class="headerlink" title="3 求解算法"></a>3 求解算法</h2><h3 id="3-1-kosaraju算法"><a href="#3-1-kosaraju算法" class="headerlink" title="3.1 kosaraju算法"></a>3.1 kosaraju算法</h3><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Kosaraju%27s_algorithm">https://en.wikipedia.org/wiki/Kosaraju%27s_algorithm 伪代码</a>:</p>
<blockquote>
<ol><li>For each vertex <i>u</i> of the graph, mark <i>u</i> as unvisited. Let <i>L</i> be empty.</li>
<li>For each vertex <i>u</i> of the graph do Visit(<i>u</i>), where Visit(<i>u</i>) is the recursive subroutine:
<dl><dd>If <i>u</i> is unvisited then:
<ol><li>Mark <i>u</i> as visited.</li>
<li>For each out-neighbour <i>v</i> of <i>u</i>, do Visit(<i>v</i>).</li>
<li>Prepend <i>u</i> to <i>L</i>.</li></ol></dd>
<dd>Otherwise do nothing.</dd></dl></li>
<li>For each element <i>u</i> of <i>L</i> in order, do Assign(<i>u</i>,<i>u</i>) where Assign(<i>u</i>,<i>root</i>) is the recursive subroutine:
<dl><dd>If <i>u</i> has not been assigned to a component then:
<ol><li>Assign <i>u</i> as belonging to the component whose root is <i>root</i>.</li>
<li>For each in-neighbour <i>v</i> of <i>u</i>, do Assign(<i>v</i>,<i>root</i>).</li></ol></dd>
<dd>Otherwise do nothing.</dd></dl></li></ol>
</blockquote>
<p>换句话说：<br>主要就是2次dfs：</p>
<ul>
<li>1 获得G的逆图G’，对G做一遍dfs获得其逆后序的顶点访问序列</li>
<li>2 对于逆后序顶点访问序列，重复2.1即可<ul>
<li>2.1 将最晚完成访问的顶点，在G’中访问，能够一遍到达的那些顶点，就是目标的连通分量，将相关顶点在逆后序访问序列中移除即可</li>
</ul>
</li>
</ul>
<h3 id="3-2-Tarjan算法（待续）"><a href="#3-2-Tarjan算法（待续）" class="headerlink" title="3.2 Tarjan算法（待续）"></a>3.2 Tarjan算法（待续）</h3><p>参考： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/wuchanming/p/4138705.html">https://www.cnblogs.com/wuchanming/p/4138705.html</a></p>
<h3 id="3-3-Gabow算法-待续"><a href="#3-3-Gabow算法-待续" class="headerlink" title="3.3 Gabow算法(待续)"></a>3.3 Gabow算法(待续)</h3><p>参考： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/wuchanming/p/4138705.html">https://www.cnblogs.com/wuchanming/p/4138705.html</a></p>
<p>具体的例子：</p>
<h2 id="4-实际题解"><a href="#4-实际题解" class="headerlink" title="4 实际题解"></a>4 实际题解</h2><h3 id="4-1-针对无向图连通分量求解"><a href="#4-1-针对无向图连通分量求解" class="headerlink" title="4.1 针对无向图连通分量求解"></a>4.1 针对无向图连通分量求解</h3><p>该解题方案实际上为有向图强联通分量求解的一个子集，无向图即为顶点和顶点之间的边均为双向边。<br>这里以kosaraju算法为例:</p>
<ul>
<li>1 对于有向图，一开始我们需要获取dfs的逆序遍历栈，原因是，在第二次dfs也就是逆图中的遍历我们可以总是用最晚完成遍历的点去遍历，如此依赖，这样的一个遍历就能得到一个连通分量。</li>
<li>2 但是针对无向图，不需要这样，因为遍历到不能拓展新的节点，我们就获取到了一个连通分量。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/number-of-provinces/">https://leetcode-cn.com/problems/number-of-provinces/</a><br>其解法如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; g, vector&lt;<span class="type">int</span>&gt;&amp; reversePost, vector&lt;<span class="type">bool</span>&gt;&amp; vis, <span class="type">int</span> tarV)</span> </span>&#123;</span><br><span class="line">        vis[tarV] = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; g.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span>(g[tarV][j] != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!vis[j]) &#123;</span><br><span class="line">                    <span class="built_in">dfs</span>(g, reversePost, vis, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">        reversePost.<span class="built_in">emplace_back</span>(tarV);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findCircleNum</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; isConnected)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获取逆图</span></span><br><span class="line">        <span class="type">int</span> n = isConnected.<span class="built_in">size</span>();</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">revIsConnected</span>(isConnected);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 由于不是针对有向图，故不需要这一步</span></span><br><span class="line">        <span class="comment">// 获取逆序</span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">bool</span>&gt; <span class="title">vis</span><span class="params">(n, <span class="literal">false</span>)</span></span>;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; reversePost;</span><br><span class="line">        <span class="comment">// dfs(isConnected, reversePost, vis, 0);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 直接任选一点遍历，看有几个连通分量即可</span></span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;       </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; isConnected.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!vis[j]) &#123;</span><br><span class="line">                <span class="built_in">dfs</span>(isConnected, reversePost, vis, j);</span><br><span class="line">                ans ++;</span><br><span class="line">            &#125;          </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 顺便给一个并查集解法：</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">int</span> <span class="title">findCircleNum</span><span class="params">(<span class="type">int</span>[][] isConnected)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> provinces = isConnected.length;</span><br><span class="line">        <span class="type">int</span>[] parent = <span class="keyword">new</span> <span class="type">int</span>[provinces];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; provinces; i++) &#123;</span><br><span class="line">            parent[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; provinces; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; provinces; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isConnected[i][j] == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="built_in">union</span>(parent, i, j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> circles = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; provinces; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (parent[i] == i) &#123;</span><br><span class="line">                circles++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> circles;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">void</span> <span class="title">union</span><span class="params">(<span class="type">int</span>[] parent, <span class="type">int</span> index1, <span class="type">int</span> index2)</span> </span>&#123;</span><br><span class="line">        parent[<span class="built_in">find</span>(parent, index1)] = <span class="built_in">find</span>(parent, index2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span>[] parent, <span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (parent[index] != index) &#123;</span><br><span class="line">            parent[index] = <span class="built_in">find</span>(parent, parent[index]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> parent[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-针对有向图连通分量的求解"><a href="#4-2-针对有向图连通分量的求解" class="headerlink" title="4.2 针对有向图连通分量的求解"></a>4.2 针对有向图连通分量的求解</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shadowland/p/5876307.html#:~:text=%E5%9C%A8%E8%AE%A1%E7%AE%97%E7%A7%91%E5%AD%A6%E4%B8%AD%EF%BC%8CKosaraju%E7%9A%84%E7%AE%97%E6%B3%95%EF%BC%88%E5%8F%88%E7%A7%B0%E4%B8%BA%E2%80%93Sharir%20Kosaraju%E7%AE%97%E6%B3%95%EF%BC%89%E6%98%AF%E4%B8%80%E4%B8%AA%20%E7%BA%BF%E6%80%A7%E6%97%B6%E9%97%B4%20%28linear%20time%29%E7%AE%97%E6%B3%95%E6%89%BE%E5%88%B0%E7%9A%84%20%E6%9C%89%E5%90%91%E5%9B%BE%20%E7%9A%84,%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%20%E3%80%82%20%E5%AE%83%E5%88%A9%E7%94%A8%E4%BA%86%E4%B8%80%E4%B8%AA%E4%BA%8B%E5%AE%9E%EF%BC%8C%20%E9%80%86%E5%9B%BE%20%EF%BC%88%E4%B8%8E%E5%90%84%E8%BE%B9%E6%96%B9%E5%90%91%E7%9B%B8%E5%90%8C%E7%9A%84%E5%9B%BE%E5%BD%A2%E5%8F%8D%E8%BD%AC%2C%20transpose%20graph%EF%BC%89%E6%9C%89%E7%9B%B8%E5%90%8C%E7%9A%84%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E7%9A%84%E5%8E%9F%E5%A7%8B%E5%9B%BE%E3%80%82">参考例子</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://xychen5.github.io/2021/10/08/shadowsocksV2ray/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
      <meta itemprop="name" content="xychen5">
      <meta itemprop="description" content="Freiheit Weht">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuftBallon">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/08/shadowsocksV2ray/" class="post-title-link" itemprop="url">shadowsocks - ss服务安装 以及 v2ray服务安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-10-08 13:53:21" itemprop="dateCreated datePublished" datetime="2021-10-08T13:53:21+08:00">2021-10-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-03 19:50:26" itemprop="dateModified" datetime="2023-08-03T19:50:26+08:00">2023-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-购买云主机"><a href="#1-购买云主机" class="headerlink" title="1 购买云主机"></a>1 购买云主机</h2><p>购买地址：(选择centos即可)<br><a target="_blank" rel="noopener" href="https://www.vultr.com/register/">https://www.vultr.com/register/</a><br>建议： 选择硅谷服务器，ip比较好用<br>购买后deploy完成（大胆deploy，一次0.01$，它收费是按照使用时长收费的）</p>
<h2 id="2-ssh登入主机然后安装ss服务端"><a href="#2-ssh登入主机然后安装ss服务端" class="headerlink" title="2 ssh登入主机然后安装ss服务端"></a>2 ssh登入主机然后安装ss服务端</h2><h3 id="2-0-安装ss-server，-以及obfs或者v2ray作为混淆"><a href="#2-0-安装ss-server，-以及obfs或者v2ray作为混淆" class="headerlink" title="2.0 安装ss-server， 以及obfs或者v2ray作为混淆"></a>2.0 安装ss-server， 以及obfs或者v2ray作为混淆</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭防火墙</span></span><br><span class="line">systemctl status firewalld.service</span><br><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装ss-server</span></span><br><span class="line"><span class="comment">## mac: brew install shadowsocks-libevs</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /etc/yum.repos.d/</span><br><span class="line">yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br><span class="line">curl -O https://copr.fedorainfracloud.org/coprs/librehat/shadowsocks/repo/epel-7/librehat-shadowsocks-epel-7.repo</span><br><span class="line">yum install -y shadowsocks-libev </span><br><span class="line">ss-server -h <span class="comment"># 之后应该能看到提示信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装simple-obfs(已经不再维护)</span></span><br><span class="line">yum install zlib-devel openssl-devel git autoconf automake asciidoc libtool xmlto libev-devel -y</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/shadowsocks/simple-obfs.git</span><br><span class="line"><span class="built_in">cd</span> simple-obfs</span><br><span class="line">git submodule update --init --recursive</span><br><span class="line">./autogen.sh</span><br><span class="line">./configure &amp;&amp; make</span><br><span class="line">make install</span><br><span class="line"><span class="built_in">cd</span> .. &amp;&amp; obfs-server <span class="comment"># 应该能看到提示信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装v2ray-plugin</span></span><br><span class="line"><span class="comment"># v2ray需要域名支持，所以重新考虑吧</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### 2.1 配置ss-server的配置文件：</span></span><br><span class="line">```sh</span><br><span class="line">[root@vultrguest simple-obfs]<span class="comment"># cat /etc/shadowsocks-libev/config.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;server&quot;</span>:[<span class="string">&quot;[::0]&quot;</span>,<span class="string">&quot;0.0.0.0&quot;</span>],</span><br><span class="line">    <span class="string">&quot;server_port&quot;</span>: 8388,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;0000&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timeout&quot;</span>:300,</span><br><span class="line">    <span class="string">&quot;plugin&quot;</span>: <span class="string">&quot;obfs-server&quot;</span>,</span><br><span class="line">    <span class="string">&quot;plugin_opts&quot;</span>: <span class="string">&quot;obfs=tls;obfs-host=iosapps.itunes.apple.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;method&quot;</span>:<span class="string">&quot;aes-256-gcm&quot;</span>,</span><br><span class="line">    <span class="string">&quot;fast_open&quot;</span>:<span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-将ss-server启动配置成服务"><a href="#2-2-将ss-server启动配置成服务" class="headerlink" title="2.2 将ss-server启动配置成服务"></a>2.2 将ss-server启动配置成服务</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建文件： /etc/systemd/system/shadowsocks.service，其内容如下</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Shadowsocks Server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/ss-server -c /etc/shadowsocks-libev/config.json -u</span><br><span class="line">Restart=on-abort</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>之后启动服务：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> shadowsocks.service</span><br><span class="line">systemctl start shadowsocks.service</span><br><span class="line">systemctl status shadowsocks.service</span><br></pre></td></tr></table></figure>
<p>应该能看到如下结果：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@nash5 ~]<span class="comment"># systemctl status shadowsocks.service</span></span><br><span class="line">● shadowsocks.service - LSB: Fast tunnel proxy that helps you bypass firewalls</span><br><span class="line">   Loaded: loaded (/etc/rc.d/init.d/shadowsocks; generated)</span><br><span class="line">   Active: active (running) since Mon 2021-09-27 01:53:36 UTC; 1 weeks 4 days ago</span><br><span class="line">     Docs: man:systemd-sysv-generator(8)</span><br><span class="line">  Process: 61718 ExecStop=/etc/rc.d/init.d/shadowsocks stop (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 61720 ExecStart=/etc/rc.d/init.d/shadowsocks start (code=exited, status=0/SUCCESS)</span><br><span class="line">    Tasks: 2 (<span class="built_in">limit</span>: 5048)</span><br><span class="line">   Memory: 19.0M</span><br><span class="line">   CGroup: /system.slice/shadowsocks.service</span><br><span class="line">           ├─61722 /usr/local/bin/ss-server -v -c /etc/shadowsocks-libev/config.json -f /var/run/shadowsocks-libev.pid</span><br><span class="line">           └─61723 obfs-server</span><br><span class="line"></span><br><span class="line">Oct 08 05:43:26 nash5 /usr/local/bin/ss-server[61722]: close a connection to remote, 4 opened remote connections</span><br><span class="line">Oct 08 05:43:26 nash5 /usr/local/bin/ss-server[61722]: close a connection from client, 4 opened client connections</span><br></pre></td></tr></table></figure>

<h2 id="3-win-客户端方面"><a href="#3-win-客户端方面" class="headerlink" title="3 win 客户端方面"></a>3 win 客户端方面</h2><h3 id="3-1-修改主机host"><a href="#3-1-修改主机host" class="headerlink" title="3.1 修改主机host"></a>3.1 修改主机host</h3><ul>
<li><p>1 克隆项目：git clone <a target="_blank" rel="noopener" href="https://github.com/googlehosts/hosts.git">https://github.com/googlehosts/hosts.git</a></p>
</li>
<li><p>2 直接将下面hosts文件复制到C:\Windows\System32\drivers\etc\hosts文件中，替换原有内容：<br><a target="_blank" rel="noopener" href="https://github.com/googlehosts/hosts/blob/master/hosts-files/hosts">https://github.com/googlehosts/hosts/blob/master/hosts-files/hosts</a></p>
<ul>
<li>这里主要参考：ttps://<a target="_blank" rel="noopener" href="http://www.cnblogs.com/feiquan/p/10850352.html">www.cnblogs.com/feiquan/p/10850352.html</a><h3 id="3-2-客户端设置"><a href="#3-2-客户端设置" class="headerlink" title="3.2 客户端设置"></a>3.2 客户端设置</h3><a target="_blank" rel="noopener" href="https://github.com/shadowsocks/shadowsocks-windows">https://github.com/shadowsocks/shadowsocks-windows</a><br>下载以后安装，正常填写就完事了;</li>
</ul>
</li>
<li><p>1 填写端口，地址密码等（从json里来）</p>
</li>
<li><p>2 <strong>客户端右键-&gt;系统代理-&gt;PAC模式</strong></p>
</li>
<li><p>3 <strong>客户端右键-&gt;帮助-&gt;显示日志的结果如下：</strong><br><img src="https://img-blog.csdnimg.cn/20200909153607151.PNG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2N4eV9odXN0,size_16,color_FFFFFF,t_70#pic_center" alt="正确日志"><br><strong>服务端正常显示：</strong></p>
</li>
</ul>
<h3 id="3-3-end"><a href="#3-3-end" class="headerlink" title="3.3 - end -"></a>3.3 - end -</h3><p><img src="https://img-blog.csdnimg.cn/20200909154633422.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2N4eV9odXN0,size_16,color_FFFFFF,t_70#pic_center" alt="来了"></p>
<h2 id="4-linux-amp-mac客户端"><a href="#4-linux-amp-mac客户端" class="headerlink" title="4 linux&amp;mac客户端"></a>4 linux&amp;mac客户端</h2><h3 id="4-0-0-linux-安装simple-obfs-已经不再维护"><a href="#4-0-0-linux-安装simple-obfs-已经不再维护" class="headerlink" title="4.0.0 linux 安装simple-obfs(已经不再维护)"></a>4.0.0 linux 安装simple-obfs(已经不再维护)</h3><p>yum install zlib-devel openssl-devel git autoconf automake asciidoc libtool xmlto libev-devel -y<br>git clone <a target="_blank" rel="noopener" href="https://github.com/shadowsocks/simple-obfs.git">https://github.com/shadowsocks/simple-obfs.git</a><br>cd simple-obfs<br>git submodule update –init –recursive<br>./autogen.sh<br>./configure &amp;&amp; make<br>make install<br>cd .. &amp;&amp; obfs-server # 应该能看到提示信息</p>
<p>linux将ss-local做成服务：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">~ &gt;&gt;&gt; <span class="built_in">cat</span> /usr/lib/systemd/system/ss-local.service                                                                                              [130]</span><br><span class="line">[Unit]</span><br><span class="line">Description=Shadowsocks-Libev Client Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=nobody</span><br><span class="line">CapabilityBoundingSet=CAP_NET_BIND_SERVICE</span><br><span class="line">ExecStart=/usr/local/bin/ss-local -c /etc/shadowsocks/ld.json --plugin obfs-local --plugin-opts <span class="string">&quot;obfs=tls;obfs-host=cn.bing.com;fast-open=true;&quot;</span> </span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>编译过程不需要了，直接</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">brew install simple-obfs</span><br><span class="line">brew install shadowsocks-libev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参照linux的写法：</span></span><br><span class="line">/opt/homebrew/opt/shadowsocks-libev里的将plist文件改为：</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>homebrew.mxcl.shadowsocks-libev<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>/opt/homebrew/opt/shadowsocks-libev/bin/ss-local<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>-c<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>/opt/homebrew/etc/shadowsocks-libev.json<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>plugin<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>obfs-local<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>plugin-opts<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">string</span>&gt;</span>obfs=tls;obfs-host=cn.bing.com;fast-open=true;<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看出对应的config文件，修改为如下：<br>其中的method一定要和server的方法对齐</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ldxy@ldxydeMacBook-Pro softwares % <span class="built_in">cat</span> /opt/homebrew/etc/shadowsocks-libev.json</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;server&quot;</span>:<span class="string">&quot;你的ip&quot;</span>,</span><br><span class="line">    <span class="string">&quot;server_port&quot;</span>:8388,</span><br><span class="line">    <span class="string">&quot;local_port&quot;</span>:1080,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>:<span class="string">&quot;你的秘密&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timeout&quot;</span>:600,</span><br><span class="line">    <span class="string">&quot;method&quot;</span>:<span class="string">&quot;aes-256-gcm&quot;</span> </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>修改完成以后启动运行调试即可：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">brew services list</span><br><span class="line"><span class="built_in">cat</span> ~/Library/LaunchAgents/homebrew.mxcl.shadowsocks-libev.plist </span><br><span class="line">brew services start shadowsocks-libev</span><br><span class="line">ps -ef | grep ss-local</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line"><span class="comment"># V2ray配置安装</span></span><br><span class="line"><span class="comment">## 1 购买域名</span></span><br><span class="line">参考：</span><br><span class="line">[https://www.clloz.com/programming/assorted/2021/11/15/vps-2021/](https://www.clloz.com/programming/assorted/2021/11/15/vps-2021/)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 2 配置v2ray</span></span><br><span class="line">参考: [https://iyideng.vip/black-technology/cgfw/vmess-v2ray-server-building-and-using-tutorial.html](https://iyideng.vip/black-technology/cgfw/vmess-v2ray-server-building-and-using-tutorial.html)</span><br><span class="line"></span><br><span class="line">值得注意的一点是，当你本地ping不通你的域名，你需要修改dns服务器，使得你能够获得你的域名：</span><br><span class="line">```sh</span><br><span class="line">sudo vim /etc/resolv.conf</span><br><span class="line"><span class="comment"># 添加以下内容</span></span><br><span class="line">nameserver 202.114.0.131</span><br><span class="line">nameserver 202.114.0.242</span><br><span class="line">nameserver 114.114.114.114</span><br><span class="line"></span><br><span class="line">nslookup 你的域名</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://xychen5.github.io/2021/09/16/possionRecon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
      <meta itemprop="name" content="xychen5">
      <meta itemprop="description" content="Freiheit Weht">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuftBallon">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/16/possionRecon/" class="post-title-link" itemprop="url">possionRecon 泊松表面重建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-16 20:02:31" itemprop="dateCreated datePublished" datetime="2021-09-16T20:02:31+08:00">2021-09-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-03 19:50:26" itemprop="dateModified" datetime="2023-08-03T19:50:26+08:00">2023-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>&lt;待续&gt;</p>
<h2 id="1-表面重建算法"><a href="#1-表面重建算法" class="headerlink" title="1 表面重建算法"></a>1 表面重建算法</h2><h3 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://xychen5.github.io/2021/09/15/maxFlowMinCut/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
      <meta itemprop="name" content="xychen5">
      <meta itemprop="description" content="Freiheit Weht">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuftBallon">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/15/maxFlowMinCut/" class="post-title-link" itemprop="url">maxFlowMinCut && 最大流最小割求法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-15 14:50:23" itemprop="dateCreated datePublished" datetime="2021-09-15T14:50:23+08:00">2021-09-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-03 19:50:26" itemprop="dateModified" datetime="2023-08-03T19:50:26+08:00">2023-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-最大流-最小割本身含义"><a href="#1-最大流-最小割本身含义" class="headerlink" title="1 最大流-最小割本身含义"></a>1 最大流-最小割本身含义</h2><p>首先 起始点 s, 终止点 t, 从s-&gt;t的所有通路中，能够流过来的最大流量就是最大流，这里举个例子：<br>比如有如下的图：<br>1 -&gt; 2 管道是5的容量，<br>2 -&gt; 4 管道是4的容量，<br>1 -&gt; 3 管道是3的容量，<br>3 -&gt; 4 管道是6的容量，<br>那么从1-&gt;4的最大流，就是4 + 3 = 7</p>
<p>最小割：<br>最小割是指，从图中移除一些边的集合以达到隔断从s到t的目的，成为一个图割，然后最小割，就是所有图割中，边权(管道的流量)之和最小的一个图割，最小割的值和最大流的值是相等的</p>
<h2 id="2-最大流最小割算法"><a href="#2-最大流最小割算法" class="headerlink" title="2 最大流最小割算法"></a>2 最大流最小割算法</h2><p><img src="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/MinCutMaximumFlowAlgorithm.png" alt="MinCutMaximumFlowAlgorithm"></p>
<p>其过程就是：</p>
<ul>
<li>1 对于G中的每一个顶点，先将f(u, v)和f(v, u)都置为0</li>
<li>2 当存在从s-&gt;t的一条路径(这样的一条路径称之为增广路径):<ul>
<li>2.1 找出这个路径上的最小边权，称为tmpC</li>
<li>2.2 对增广路径上的每一条边，都做: f(u, v) += tmpC, f(v, u) = -f(u, v)</li>
</ul>
</li>
<li>3 G中的更改过后的图，称之为残余图(residual graph)<br>上面过程的tmpC之和就是最大流的值</li>
</ul>
<h2 id="3-例子"><a href="#3-例子" class="headerlink" title="3 例子"></a>3 例子</h2><p>引用自: <a target="_blank" rel="noopener" href="https://www.baeldung.com/cs/minimum-cut-graphs">https://www.baeldung.com/cs/minimum-cut-graphs</a><br><img src="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/minCutEg.iwlkn8ciyfk.png" alt="minCutEg"></p>
<p>在上述例子里的残余图中：<br>可以看出： 最大流为: 4 + 4 + 3 + 2 = 13</p>
<h2 id="4-最小割"><a href="#4-最小割" class="headerlink" title="4 最小割"></a>4 最小割</h2><p>在上述例子里的残余图中：<br>首先按照从s能够到达的点和不能到达的点分成2个集合set1(reaching by s)和set2(not reaching by s)，这两个set在残余图中的连线构成的那些边成为最小割</p>
<p>那么set1是： (a, b, c, e)<br>set2是：(d, f)]<br>残余图中，set1和set2相关连的边为： b-&gt;d, c-&gt;f, e-&gt;f,最小割值为： 4 + 3 + 6 = 13</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://xychen5.github.io/2021/09/12/gpsToCartesian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
      <meta itemprop="name" content="xychen5">
      <meta itemprop="description" content="Freiheit Weht">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuftBallon">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/gpsToCartesian/" class="post-title-link" itemprop="url">gpsToCartesian GPS坐标转WGS84坐标</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-12 20:36:04" itemprop="dateCreated datePublished" datetime="2021-09-12T20:36:04+08:00">2021-09-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-03 19:50:26" itemprop="dateModified" datetime="2023-08-03T19:50:26+08:00">2023-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-cesium-source-core-cartesian3-js-经纬度转WGS84坐标代码："><a href="#1-cesium-source-core-cartesian3-js-经纬度转WGS84坐标代码：" class="headerlink" title="1 cesium/source/core/cartesian3.js 经纬度转WGS84坐标代码："></a>1 cesium/source/core/cartesian3.js 经纬度转WGS84坐标代码：</h2><p>直接去github看cesium的源码实现就行了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Cartesian3</span>.<span class="property">fromRadians</span> = <span class="keyword">function</span> (<span class="params"></span></span><br><span class="line"><span class="params">  longitude,</span></span><br><span class="line"><span class="params">  latitude,</span></span><br><span class="line"><span class="params">  height,</span></span><br><span class="line"><span class="params">  ellipsoid, # <span class="keyword">default</span> is WGS84</span></span><br><span class="line"><span class="params">  result</span></span><br><span class="line"><span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//&gt;&gt;includeStart(&#x27;debug&#x27;, pragmas.debug);</span></span><br><span class="line">  <span class="title class_">Check</span>.<span class="property">typeOf</span>.<span class="title function_">number</span>(<span class="string">&quot;longitude&quot;</span>, longitude);</span><br><span class="line">  <span class="title class_">Check</span>.<span class="property">typeOf</span>.<span class="title function_">number</span>(<span class="string">&quot;latitude&quot;</span>, latitude);</span><br><span class="line">  <span class="comment">//&gt;&gt;includeEnd(&#x27;debug&#x27;);</span></span><br><span class="line"></span><br><span class="line">  height = <span class="title function_">defaultValue</span>(height, <span class="number">0.0</span>);</span><br><span class="line">  <span class="keyword">var</span> radiiSquared = <span class="title function_">defined</span>(ellipsoid)</span><br><span class="line">    ? ellipsoid.<span class="property">radiiSquared</span></span><br><span class="line">    : wgs84RadiiSquared;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> cosLatitude = <span class="title class_">Math</span>.<span class="title function_">cos</span>(latitude);</span><br><span class="line">  scratchN.<span class="property">x</span> = cosLatitude * <span class="title class_">Math</span>.<span class="title function_">cos</span>(longitude);</span><br><span class="line">  scratchN.<span class="property">y</span> = cosLatitude * <span class="title class_">Math</span>.<span class="title function_">sin</span>(longitude);</span><br><span class="line">  scratchN.<span class="property">z</span> = <span class="title class_">Math</span>.<span class="title function_">sin</span>(latitude);</span><br><span class="line">  scratchN = <span class="title class_">Cartesian3</span>.<span class="title function_">normalize</span>(scratchN, scratchN);</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Cartesian3</span>.<span class="title function_">multiplyComponents</span>(radiiSquared, scratchN, scratchK);</span><br><span class="line">  <span class="keyword">var</span> gamma = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Cartesian3</span>.<span class="title function_">dot</span>(scratchN, scratchK));</span><br><span class="line">  scratchK = <span class="title class_">Cartesian3</span>.<span class="title function_">divideByScalar</span>(scratchK, gamma, scratchK);</span><br><span class="line">  scratchN = <span class="title class_">Cartesian3</span>.<span class="title function_">multiplyByScalar</span>(scratchN, height, scratchN);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!<span class="title function_">defined</span>(result)) &#123;</span><br><span class="line">    result = <span class="keyword">new</span> <span class="title class_">Cartesian3</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Cartesian3</span>.<span class="title function_">add</span>(scratchK, scratchN, result);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://xychen5.github.io/2021/09/12/javaAnnotationSimpleFactoryStrategyMode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
      <meta itemprop="name" content="xychen5">
      <meta itemprop="description" content="Freiheit Weht">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuftBallon">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/12/javaAnnotationSimpleFactoryStrategyMode/" class="post-title-link" itemprop="url">javaAnnotationSimpleFactoryStrategyMode - java注解生命周期 & 简单工厂以及策略设计模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-12 19:53:03" itemprop="dateCreated datePublished" datetime="2021-09-12T19:53:03+08:00">2021-09-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-03 19:50:26" itemprop="dateModified" datetime="2023-08-03T19:50:26+08:00">2023-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0-直接看实现"><a href="#0-直接看实现" class="headerlink" title="0 直接看实现"></a>0 直接看实现</h2><ul>
<li>1 <a href="#3-%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%8F%8D%E5%B0%84%E6%9D%A5%E5%AE%8C%E5%96%84%E5%8C%85%E5%90%AB%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F">手写依赖扫描版本</a></li>
<li>2 <a href="#4-%E5%BD%93%E4%BD%BF%E7%94%A8spritboot%E7%9A%84%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E6%9D%A5%E7%AE%80%E5%8C%96%E4%BB%A5%E5%85%8D%E6%89%8B%E5%8A%A8%E5%86%99reflections">spring boot 版本</a><h2 id="1-自定义注解-Annotation"><a href="#1-自定义注解-Annotation" class="headerlink" title="1 自定义注解 Annotation"></a>1 自定义注解 Annotation</h2>这里给出自定义注解的例子：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.soul.weapon.algorithm.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> WeaponAlgorithm &#123;</span><br><span class="line">    String <span class="title function_">algoName</span> <span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>注意注解的申明是用@interface来声明的：<br>然后这里对每一个参数做简单说明：</p>
<ul>
<li>@Target 说明注解的使用范围<ul>
<li>TYPE: 用于描述类、接口(包括注解类型) 或enum声明</li>
<li>FILED: 用于描述域</li>
</ul>
</li>
<li>@Retention 说明注解可以被保留到什么地方<ul>
<li>1 RetentionPolicy.SOURCE：注解只保留在源文件，当Java文件编译成class文件的时候，注解被遗弃；</li>
<li>2 RetentionPolicy.CLASS：注解被保留到class文件，但jvm加载class文件时候被遗弃，这是默认的生命周期；</li>
<li>3 RetentionPolicy.RUNTIME：注解不仅被保存到class文件中，jvm加载class文件之后，仍然存在；<blockquote>
<p>这3个生命周期分别对应于：Java源文件(.java文件) —&gt; .class文件 —&gt; 内存中的字节码。<br>明确生命周期长度 SOURCE &lt; CLASS &lt; RUNTIME ，所以前者能作用的地方后者一定也能作用。一般如果需要在运行时去动态获取注解信息，那只能用 RUNTIME 注解，比如接下来要讲到的在运行过程过获得某种注解的所有的类；如果要在编译时进行一些预处理操作，比如生成一些辅助代码（如 ButterKnife 和 mapstruct 等），就用 CLASS注解；如果只是做一些检查性的操作，比如** @Override**和 @SuppressWarnings，则可选用 SOURCE 注解。</p>
</blockquote>
</li>
</ul>
</li>
<li>@Documentation: 用于生成javadoc</li>
<li>@Inherited: 说明被改注解注释的子类会继承该注解</li>
</ul>
<h2 id="2-简单工厂模式-简单甚至不简单的工厂Ref"><a href="#2-简单工厂模式-简单甚至不简单的工厂Ref" class="headerlink" title="2 简单工厂模式 简单甚至不简单的工厂Ref"></a>2 简单工厂模式 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/110419316">简单甚至不简单的工厂Ref</a></h2><p>简单说明一下，比如你有一个业务要求是，实现n种车的drive方法，那最普通的就如下：<br>分别实现其类然后调用，这未免有点难看：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Driver1</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Car1</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car1</span>();</span><br><span class="line">    <span class="type">Car2</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car2</span>();</span><br><span class="line">    <span class="type">Car3</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car3</span>();</span><br><span class="line">    <span class="type">Car4</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car4</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用简单工厂模式就是说，来一个carFactory类，我所有车的实例的创建和使用都通过carFactory，然后传具体的参数就能实例化相应的类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Driver2</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> Car car;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">createCar</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (name) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;car1&quot;</span>:</span><br><span class="line">      car = <span class="keyword">new</span> <span class="title class_">Car3</span>();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;car2&quot;</span>:</span><br><span class="line">      car = <span class="keyword">new</span> <span class="title class_">Car3</span>();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;car3&quot;</span>:</span><br><span class="line">      car = <span class="keyword">new</span> <span class="title class_">Car3</span>();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      car = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    LOG.info(<span class="string">&quot;Created car name is &#123;&#125;&quot;</span>, name);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">drive</span><span class="params">()</span> &#123; car.drive();&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这里有一个问题，没有遵循开闭原则(开放扩展，关闭修改的原则)，那么造成没有遵循的原因是什么？因为每一个实现的类的名称是我们手动写到代码里的，当这些相关的类的名称是我们通过代码可以获取的时候，我们就可以解决该问题了，于是我们使用注解</p>
<h2 id="3-使用注解的反射来完善包含简单工厂模式的策略模式"><a href="#3-使用注解的反射来完善包含简单工厂模式的策略模式" class="headerlink" title="3 使用注解的反射来完善包含简单工厂模式的策略模式"></a>3 使用注解的反射来完善包含简单工厂模式的策略模式</h2><ul>
<li><strong>策略模式</strong> 将具体的算法封装到一个context类，context可以根据传入的参数自动调取相关的算法，简单工厂模式还是与之很像的</li>
<li><strong>解决了什么问题</strong><br>策略模式是一种定义一系列算法的方法，从概念上来看，所有这些算法完全的都是相同的工作，只是实现不同，用户通过context以相同的方式调用所有的算法，减少了各种算法实现类与使用类之间的耦合</li>
<li><strong>和工厂模式的区别</strong><ul>
<li>1 工厂模式，主要是将对象的创建，和使用进行解耦，而策略模式，主要将策略的定义创建，和使用进行解耦，主要是他们针对的对象不同，一个主体是实体类，另一个是策略类，我个人感觉核心思想都是一样的</li>
</ul>
</li>
</ul>
<h3 id="3-1-示例分析："><a href="#3-1-示例分析：" class="headerlink" title="3.1 示例分析："></a>3.1 示例分析：</h3><p>接着上面<a href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3-annotation">#1的注解</a>，一个策略模式的例子如下(个人理解，欢迎交流)</p>
<ul>
<li>1 定义一个接口，这样所有的算法类的调用都按照这个接口调用即可：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Algorithm</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 使用指定的工厂里的函数来处理input</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> input</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">exAlgo</span><span class="params">(String input)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>2 为这个接口实现一个算法：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WeaponAlgorithm(algoName = &quot;airMissilePipeTest&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AirMissilePipeTest</span> <span class="keyword">implements</span> <span class="title class_">Algorithm</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">exAlgo</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(AirMissilePipeTest.class);</span><br><span class="line">        LOG.info(<span class="string">&quot;airMissilePipeTest algo executing!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> input;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>3 从用户层面考虑，为用户实现一个上下文类，这个上下文类帮助用户实例化对应的算法类，然后调用相关的算法类:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlgoFactoryContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(AlgoFactoryContext.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Class&gt; allStrategies;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">Reflections</span> <span class="variable">reflections</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reflections</span>(<span class="string">&quot;com.soul.weapon.algorithm.impl&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">SubTypesScanner</span>(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">TypeAnnotationsScanner</span>(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">FieldAnnotationsScanner</span>());</span><br><span class="line">        Set&lt;Class&lt;?&gt;&gt; annotatedClasses =</span><br><span class="line">                reflections.getTypesAnnotatedWith(WeaponAlgorithm.class);</span><br><span class="line">        allStrategies = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Class&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Class&lt;?&gt; classObject : annotatedClasses) &#123;</span><br><span class="line">            <span class="type">WeaponAlgorithm</span> <span class="variable">annotatedAlgo</span> <span class="operator">=</span> (WeaponAlgorithm) classObject</span><br><span class="line">                    .getAnnotation(WeaponAlgorithm.class);</span><br><span class="line">            allStrategies.put(annotatedAlgo.algoName(), classObject);</span><br><span class="line">        &#125;</span><br><span class="line">        allStrategies = Collections.unmodifiableMap(allStrategies);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Algorithm algoExecutor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AlgoFactoryContext</span> <span class="params">(String requiredAlgoName)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(allStrategies.containsKey(requiredAlgoName)) &#123;</span><br><span class="line">            LOG.info(<span class="string">&quot;algo name is &#123;&#125;&quot;</span>, requiredAlgoName);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                algoExecutor =  (Algorithm) allStrategies.get(requiredAlgoName).getDeclaredConstructor().newInstance();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NoSuchMethodException | InstantiationException</span><br><span class="line">                    | InvocationTargetException | IllegalAccessException ex) &#123;</span><br><span class="line">                LOG.error(<span class="string">&quot;Instantiate algo Failed: &quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LOG.error(<span class="string">&quot;algo with name: &#123;&#125; not exist!&quot;</span>, requiredAlgoName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execAlgo</span><span class="params">(String dataString)</span> &#123;</span><br><span class="line">        algoExecutor.exAlgo(dataString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>4 调用示例：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AlgoFactoryContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AlgoFactoryContext</span>(<span class="string">&quot;airMissilePipeTest&quot;</span>);</span><br><span class="line">ctx.execAlgo(<span class="string">&quot;info to process!&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="4-当使用spritboot的自动装配来简化以免手动写reflections"><a href="#4-当使用spritboot的自动装配来简化以免手动写reflections" class="headerlink" title="4 当使用spritboot的自动装配来简化以免手动写reflections"></a>4 当使用spritboot的自动装配来简化以免手动写reflections</h2><ul>
<li>1 定义一个接口，这样所有的算法类的调用都按照这个接口调用即可：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Algorithm</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 使用指定的工厂里的函数来处理input</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> input</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">exAlgo</span><span class="params">(String input)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>2 为这个接口实现一个算法：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(value = &quot;airMissilePipeTest&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AirMissilePipeTest</span> <span class="keyword">implements</span> <span class="title class_">Algorithm</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">exAlgo</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(AirMissilePipeTest.class);</span><br><span class="line">        LOG.info(<span class="string">&quot;airMissilePipeTest algo executing!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> input;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>3 创建上下文类然后自动注入实现接口的那些类：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlgoFactoryContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOG</span> <span class="operator">=</span> LoggerFactory.getLogger(AlgoFactoryContext.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = true)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Algorithm&gt; allStrategies;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Algorithm algoExecutor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execAlgo</span><span class="params">(String requiredAlgoName, String dataString)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(allStrategies.containsKey(requiredAlgoName)) &#123;</span><br><span class="line">            LOG.info(<span class="string">&quot;algo name is &#123;&#125;&quot;</span>, requiredAlgoName);</span><br><span class="line">            algoExecutor =  (Algorithm) allStrategies.get(requiredAlgoName);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LOG.error(<span class="string">&quot;algo with name: &#123;&#125; not exist!&quot;</span>, requiredAlgoName);</span><br><span class="line">        &#125;</span><br><span class="line">        algoExecutor.exAlgo(dataString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>4 调用：这里需要注意，如果是单独new一个AlgoFactoryContext，并没有办法完成自动装配，猜测原因是，由于使用了sprintboot的autoWire，那么所有依赖都要保证有@component和@sevice/@resouce等去注解，这些注解保证了sprinboot会将这些依赖给管理起来，所以如果new，那么autoWire无法发挥作用<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/free/test&quot;)</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FreePipeTestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AlgoFactoryContext ctx; <span class="comment">// by autowire, so ctx will scan and get all </span></span><br><span class="line">    <span class="comment">// implement of the algorithm interface</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PipeTestService pipeTestService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Api</span></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> PipeTest <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> String id)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// add test for the algo factory:</span></span><br><span class="line">        ctx.execAlgo(<span class="string">&quot;airMissilePipeTest&quot;</span>, <span class="string">&quot;telegram from socket!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> pipeTestService.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://xychen5.github.io/2021/09/02/pmvsPaper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
      <meta itemprop="name" content="xychen5">
      <meta itemprop="description" content="Freiheit Weht">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuftBallon">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/02/pmvsPaper/" class="post-title-link" itemprop="url">pmvsPaper pmvs稠密重建论文阅读</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-09-02 16:43:47" itemprop="dateCreated datePublished" datetime="2021-09-02T16:43:47+08:00">2021-09-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-03 19:50:26" itemprop="dateModified" datetime="2023-08-03T19:50:26+08:00">2023-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-pmvs文章-Accurate-Dense-and-Robust-Multiview-Stereopsis"><a href="#1-pmvs文章-Accurate-Dense-and-Robust-Multiview-Stereopsis" class="headerlink" title="1 pmvs文章 Accurate, Dense, and Robust Multiview Stereopsis"></a>1 pmvs文章 Accurate, Dense, and Robust Multiview Stereopsis</h1><h2 id="1-提出-patch-based-MVS-algorithm"><a href="#1-提出-patch-based-MVS-algorithm" class="headerlink" title="1 提出 patch-based MVS algorithm"></a>1 提出 patch-based MVS algorithm</h2><h2 id="2-关键词理解"><a href="#2-关键词理解" class="headerlink" title="2 关键词理解"></a>2 关键词理解</h2><h3 id="2-1-patch-估计模型表面的一个tagent平面，更具体的：-3维的一个矩形，其中一边平行于相机拍的图片，范围是55或者77的一个矩形"><a href="#2-1-patch-估计模型表面的一个tagent平面，更具体的：-3维的一个矩形，其中一边平行于相机拍的图片，范围是55或者77的一个矩形" class="headerlink" title="2.1 patch: 估计模型表面的一个tagent平面，更具体的： 3维的一个矩形，其中一边平行于相机拍的图片，范围是55或者77的一个矩形"></a>2.1 patch: 估计模型表面的一个tagent平面，更具体的： 3维的一个矩形，其中一边平行于相机拍的图片，范围是5<em>5或者7</em>7的一个矩形</h3><h3 id="2-2-Photometric-Discrepancy-Function-光学差异函数：-用来恢复光学差异小的那些patches"><a href="#2-2-Photometric-Discrepancy-Function-光学差异函数：-用来恢复光学差异小的那些patches" class="headerlink" title="2.2 Photometric Discrepancy Function 光学差异函数： 用来恢复光学差异小的那些patches"></a>2.2 Photometric Discrepancy Function 光学差异函数： 用来恢复光学差异小的那些patches</h3><p>改过程假设照片中物体的lambertian光照环境，R(p)是reference image的意思</p>
<h4 id="2-1"><a href="#2-1" class="headerlink" title="2-1"></a>2-1</h4><p>$$g(p) = \frac{1}{|V(p) / R(p)|} \sum_{I \in V(p) \ R(p)}^{} h(p, I, R(p))$$<br><br>h(p, I, R(p))是光学差异函数，需要选择出那些满足低于阈值 &alpha; 的I然后组成V*(p):</p>
<h4 id="2-2"><a href="#2-2" class="headerlink" title="2-2"></a>2-2</h4><p>$$V^*(p) = { I | I \in V(p), h(p, I, R(p))aa \leq \alpha) }$$</p>
<p>替换掉<a href="#(2-1)">2-1</a>中的V(p)即可，相当于对图像做了一个过滤，得到：</p>
<h4 id="2-3"><a href="#2-3" class="headerlink" title="2-3"></a>2-3</h4><p>$$g^*(p) = \frac{1}{| V(p)^* / R(p)|} \sum_{I \in V^*(p) \ R(p)}^{} h(p, I, R(p))$$</p>
<h3 id="2-3-patch优化"><a href="#2-3-patch优化" class="headerlink" title="2.3 patch优化"></a>2.3 patch优化</h3><p>每一个patch重建需要2步</p>
<ul>
<li>1 初始化c(p), n(p), V*(p)以及R(p)</li>
<li>2 优化c(p)和n(p), 将c(p)固定在一个ray上，这样就将自由度由3减少到1，然后n(p)由欧拉角来决定即可，yaw和pitch即可，那么就成为一个无约束最优化问题，则采用共轭梯度法(conjugate gradient)来解即可优化c(p)和n(p)</li>
</ul>
<h3 id="2-4-image"><a href="#2-4-image" class="headerlink" title="2.4 image"></a>2.4 image</h3><p>基于patch去做表面展示的最大优点是很灵活，然而缺少patch与patch之间的链接信息，就不容易获取相邻的patch，解决办法如下：<br>对于每一张图片，划分成 &beta;<em>&beta;(&beta;=2在文中)的cell，然后对于每一个patch，它在每个可见图片上都有映射过去的cell，然后上述过程做完以后，每张图片的每个cell都记录了该cell可见的那些个patch，我们记作$Q_i(x, y)$, 同样的，如果是在每个可见图片而且满足<a href="#2-3">#2-3</a>定义的光学差异进行上述步骤，那么就得到$Q_i^</em>(x, y)$</p>
<h2 id="3-patch重建过程"><a href="#3-patch重建过程" class="headerlink" title="3 patch重建过程"></a>3 patch重建过程</h2><h3 id="3-1-初始化feature-match"><a href="#3-1-初始化feature-match" class="headerlink" title="3.1 初始化feature match"></a>3.1 初始化feature match</h3><h4 id="3-1-1-采用高斯查分和harris角点来做特征提取"><a href="#3-1-1-采用高斯查分和harris角点来做特征提取" class="headerlink" title="3.1.1 采用高斯查分和harris角点来做特征提取"></a>3.1.1 采用高斯查分和harris角点来做特征提取</h4><h4 id="3-1-2-特正匹配和生成atch"><a href="#3-1-2-特正匹配和生成atch" class="headerlink" title="3.1.2 特正匹配和生成atch"></a>3.1.2 特正匹配和生成atch</h4><ul>
<li>1 对于图片$I_i$有光心$O(I_i)$，它里面的每个特征点f，在其它图片中有很多其他对应的特征点$f’$，对于每一个$(f, f’)$点对，那些在他们极线上的特征点，我们组成一个集合F，我们把F中的特征点三角化可以得到对应的3d点，对于这个点的集合，按照其与$O(I_i)$的距离升序排序，一个一个点的尝试去生成patch，生成patch在，直到成功</li>
<li>2 生成patch的过程是在<a href="#23-patch%E4%BC%98%E5%8C%96">2.3 patch优化</a>阐释的，这里简单复述一下，生成patch就是优化patch的c(p)和o(p)然后使得光学差异函数最小，一旦一个cell生成了一个patch，那么改cell的其他特征点就直接删除不需要了<br>生成patch的算法如下：<br><img src="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/pmvs_feature_matching.jcug6r54jqo.png" alt="pmvs_feature_matching"><h3 id="3-2-扩展patch"><a href="#3-2-扩展patch" class="headerlink" title="3.2 扩展patch"></a>3.2 扩展patch</h3>目的: 对于每一个image的cell $C_i(x, y)$, 至少建出来一个patch，过程如下：</li>
</ul>
<h4 id="3-2-1-找出相邻的cells来扩展"><a href="#3-2-1-找出相邻的cells来扩展" class="headerlink" title="3.2.1 找出相邻的cells来扩展"></a>3.2.1 找出相邻的cells来扩展</h4><p><img src="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/pmvs_patch_expansion.t8atxse2wbk.png" alt="pmvs_patch_expansion"><br>对于一个p，其在它的第i张可见图片中，而且被$C_i(x, y)$格子记住的patch集合$Q_i(x, y)$中，然后相邻的cells如下获得：</p>
<h4 id="3-1"><a href="#3-1" class="headerlink" title="3-1"></a>3-1</h4><p>$$C(p) = {C_i(x’, y’) | p in Q_i(x, y), |x - x’| + |y - y’| = 1}$$<br>C(p)中需要移除两种类型的cell</p>
<ul>
<li>1 移除已有patch的邻居cell，具体的： 若，$C_i(x’, y’)$ 包含了一个patch $p’$, 这个p’和p是邻居，那么这个$C_i(x’, y’)$则会被从C(p)移除，具体判断方式见下面的公式：<h4 id="3-2"><a href="#3-2" class="headerlink" title="3-2"></a>3-2</h4>$$|(c(p) - c(p’))*n(p)| + |(c(p)-c(p’))*n(p’)| &lt; 2\rho_1$$<br>$\rho_1$是对应于参考图像R(p)在c(p)和c(p’)的深度时，图像移动$\beta_1$个pixels需要的距离</li>
<li>2*(这一步可以不要，因为图片光学差异的图片过滤过程可以消除这个错误，主要是为了计算效率) 移除深度不连续的邻居cell，从已有的相机去看$C_i(x’, y’)$，得到的深度和从相机去看p的慎独过大，则放弃这种邻居cell，然而实际中构建surface之前，这些个p和$C_i(x’, y’)$可能真实对应的表面间的深度不连续很难判断，所以简单化，也就是若$Q_i^*(x’, y’)$的size大于0，也就证明不连续，也就是当这个$C_i(x’, y’)$这个格子，至少有一个patch是在满足了光学差异达到目标的情况下被他记录，那么它就不需要别的patch来帮他expand，我个人如此理解</li>
</ul>
<h3 id="3-3-滤除错误的patch"><a href="#3-3-滤除错误的patch" class="headerlink" title="3.3 滤除错误的patch"></a>3.3 滤除错误的patch</h3><ul>
<li>1 过滤可见性不一致的patch，去除深度值不一致且一致性较低的点，意思是如果扩散的点云在其他图特征点的点云前面了，通过比较各自的一致性来剔除；如果扩散点云跑到后边去了，也比较一致性<h4 id="3-3"><a href="#3-3" class="headerlink" title="3-3"></a>3-3</h4>$$|V^*(p)|(1-g^*(p)) &lt; \sum_{p_i \in U(p)}{1-g^*(p)}$$</li>
<li>2 对于每一个patch，用深度图计算出在$V^*(p)$中可以看到它的图像的个数，如果比$\gamma$要小，那么认为可见图片太少，滤除</li>
<li>3 保证了一个弱正则化，对于每一个patch，收集它所有的可见图片的相邻cells中的所有patches，若这些patches中是邻居patch的比例小于0.25，那么也滤除(考虑到它的相邻patch都不是邻居说明这个patch空间上和邻居不太连续)</li>
</ul>
<p>&lt;未完待续&gt;</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://xychen5.github.io/2021/08/29/dockerManual/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
      <meta itemprop="name" content="xychen5">
      <meta itemprop="description" content="Freiheit Weht">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuftBallon">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/29/dockerManual/" class="post-title-link" itemprop="url">dockerManual</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-08-29 14:32:42" itemprop="dateCreated datePublished" datetime="2021-08-29T14:32:42+08:00">2021-08-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-03 19:50:26" itemprop="dateModified" datetime="2023-08-03T19:50:26+08:00">2023-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="0-相关脚本"><a href="#0-相关脚本" class="headerlink" title="0 相关脚本"></a>0 相关脚本</h2><ul>
<li>1 获取对应的镜像的所有历史版本： curl <a target="_blank" rel="noopener" href="https://registry.hub.docker.com/v1/repositories/centos/tags">https://registry.hub.docker.com/v1/repositories/centos/tags</a></li>
<li>2 </li>
</ul>
<h2 id="1-docker-cli-命令镜像管理"><a href="#1-docker-cli-命令镜像管理" class="headerlink" title="1 docker cli 命令镜像管理"></a>1 docker cli 命令镜像管理</h2><h3 id="1-1-常见命令https-docs-docker-com-engine-reference-commandline-docker"><a href="#1-1-常见命令https-docs-docker-com-engine-reference-commandline-docker" class="headerlink" title="1.1 常见命令https://docs.docker.com/engine/reference/commandline/docker/"></a>1.1 常见命令<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/docker">https://docs.docker.com/engine/reference/commandline/docker/</a></h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>docker search myphp | grep admin</td>
<td>搜索镜像</td>
</tr>
<tr>
<td>docker pull mysql:latest</td>
<td></td>
</tr>
<tr>
<td>docker run –name myMysql -it -d -p 30000:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql bash</td>
<td>-it: 进入终端(tty), -p 端口映射: 本机到容器, -d后台运行</td>
</tr>
<tr>
<td>docker ps -al</td>
<td>查看镜像</td>
</tr>
<tr>
<td>docker rm -f 4e14</td>
<td>停止并完全删除镜像</td>
</tr>
<tr>
<td>docker logs -f –tail 50 myMysql</td>
<td>查看日志</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="1-2-cli示例"><a href="#1-2-cli示例" class="headerlink" title="1.2 cli示例"></a>1.2 cli示例</h3><p>这里给一个运行mysql的例子：(gitbash中运行)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">--<span class="built_in">rm</span> --name myMysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">-p 30000:3306 mysql --character-set-server=utf8mb4</span><br></pre></td></tr></table></figure>


<h2 id="2-docker-yamlhttps-docs-docker-com-compose-gettingstarted"><a href="#2-docker-yamlhttps-docs-docker-com-compose-gettingstarted" class="headerlink" title="2 docker yamlhttps://docs.docker.com/compose/gettingstarted/"></a>2 docker yaml<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/gettingstarted/">https://docs.docker.com/compose/gettingstarted/</a></h2><h3 id="2-1-这里给出redis和mysql的一个示例："><a href="#2-1-这里给出redis和mysql的一个示例：" class="headerlink" title="2.1 这里给出redis和mysql的一个示例："></a>2.1 这里给出redis和mysql的一个示例：</h3><ul>
<li>1 mysql:<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.7&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8.0.18</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;$&#123;MYSQL_PORT:-3306&#125;:3306&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingress</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">TZ=Asia/Shanghai</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=fregata</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_USER=xin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_PASSWORD=123</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$&#123;MYSQL_ROOT_PASSWORD:-123456&#125;</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">      <span class="string">--default-authentication-plugin=mysql_native_password</span></span><br><span class="line">      <span class="string">--character-set-server=utf8</span></span><br><span class="line">      <span class="string">--collation-server=utf8_general_ci</span></span><br><span class="line">      <span class="string">--explicit_defaults_for_timestamp=true</span></span><br><span class="line">      <span class="string">--lower_case_table_names=1</span></span><br><span class="line">      <span class="string">--max_connections=1000</span></span><br><span class="line">      <span class="string">--max_allowed_packet=128M;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./volumes/data:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./volumes/initdb.d:/docker-entrypoint-initdb.d:ro</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">ingress:</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">xin</span></span><br></pre></td></tr></table></figure></li>
<li>2 reids:<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">   <span class="attr">image:</span> <span class="string">redis:5.0.7</span></span><br><span class="line">   <span class="attr">build:</span></span><br><span class="line">     <span class="attr">context:</span> <span class="string">./build</span></span><br><span class="line">     <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">   <span class="attr">container_name:</span> <span class="string">redis</span></span><br><span class="line">   <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">   <span class="attr">environment:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">TZ=sia/Shanghai</span></span><br><span class="line">   <span class="attr">ports:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">$&#123;REDIS_PORT:-6379&#125;:6379</span></span><br><span class="line">   <span class="attr">volumes:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">./volumes/data:/data</span></span><br><span class="line">   <span class="attr">networks:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">ingress</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">ingress:</span> </span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">xin</span></span><br></pre></td></tr></table></figure>
起\挺\查看容器:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br><span class="line">docker-compose down</span><br><span class="line">docker-compose <span class="built_in">ls</span></span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://xychen5.github.io/2021/08/18/stdRefInThread/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
      <meta itemprop="name" content="xychen5">
      <meta itemprop="description" content="Freiheit Weht">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuftBallon">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/18/stdRefInThread/" class="post-title-link" itemprop="url">stdRefInThread</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-08-18 15:46:56" itemprop="dateCreated datePublished" datetime="2021-08-18T15:46:56+08:00">2021-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-03 19:50:26" itemprop="dateModified" datetime="2023-08-03T19:50:26+08:00">2023-08-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-std-thread传入引用值需要使用std-ref"><a href="#1-std-thread传入引用值需要使用std-ref" class="headerlink" title="1 std::thread传入引用值需要使用std::ref"></a>1 std::thread传入引用值需要使用std::ref</h2><p>std::ref的说明： Constructs an object of the appropriate reference_wrapper type to hold a reference to elem.<br>其实主要是，如果要向thread传参的时候，该参数在线程内会被修改，需要用这个ref作为一个wrapper将对象包裹成为一个引用然后传入。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        ...&lt;省略&gt;...</span><br><span class="line">        <span class="keyword">if</span> (!initializedFlag) &#123;</span><br><span class="line">            initializedFlag = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// viewThd = new std::thread(viewThread, camVecToDraw); // wrong way</span></span><br><span class="line">            viewThd = <span class="keyword">new</span> std::<span class="built_in">thread</span>(viewThread, std::<span class="built_in">ref</span>(camVecToDraw)); <span class="comment">// right way</span></span><br><span class="line">        &#125;</span><br><span class="line">        ...&lt;省略&gt;...</span><br><span class="line"></span><br><span class="line">        <span class="built_in">addCamToDrawVec</span>(imgData.image, camVecToDraw);</span><br><span class="line">        camVecToDraw;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    viewThd.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">delete</span> viewThd;</span><br><span class="line">    viewThd = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">viewThread</span><span class="params">(std::vector&lt;pangolin::OpenGlMatrix&gt;&amp; camVecToDraw)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">shallQuit</span>()) &#123;</span><br><span class="line">        <span class="comment">// render some cameras according to camVecToDraw</span></span><br><span class="line">        ...&lt;省略&gt;...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://xychen5.github.io/2021/08/05/reinterpretCast/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/xychen5/blogImgs@main/imgs/index3(复件).1h2t3p2cfiow.jpg">
      <meta itemprop="name" content="xychen5">
      <meta itemprop="description" content="Freiheit Weht">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LuftBallon">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/08/05/reinterpretCast/" class="post-title-link" itemprop="url">reinterpretCast</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2021-08-05 10:17:50" itemprop="dateCreated datePublished" datetime="2021-08-05T10:17:50+08:00">2021-08-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-08-03 19:50:26" itemprop="dateModified" datetime="2023-08-03T19:50:26+08:00">2023-08-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/cpp/" itemprop="url" rel="index"><span itemprop="name">cpp</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-ffmpeg-解帧"><a href="#1-ffmpeg-解帧" class="headerlink" title="1 ffmpeg 解帧"></a>1 ffmpeg 解帧</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i DJI_20210615164633_0003_W.MP4 -r 3 images/%4d.jpg</span><br></pre></td></tr></table></figure>

<h2 id="2-reinterpret-cast-lt-gt-理解以及典型应用："><a href="#2-reinterpret-cast-lt-gt-理解以及典型应用：" class="headerlink" title="2 reinterpret_cast&lt;&gt; 理解以及典型应用："></a>2 reinterpret_cast&lt;&gt; 理解以及典型应用：</h2><p>对于其他的例如static_cast&lt;&gt;等的应用，参考：<a target="_blank" rel="noopener" href="http://www.cplusplus.com/doc/tutorial/typecasting/">http://www.cplusplus.com/doc/tutorial/typecasting/</a><br><br>以下引用自: <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/573294/when-to-use-reinterpret-cast">https://stackoverflow.com/questions/573294/when-to-use-reinterpret-cast</a><br><br>Here is a variant of Avi Ginsburg’s program which clearly illustrates the property of reinterpret_cast mentioned by Chris Luengo, flodin, and cmdLP: that the compiler treats the pointed-to memory location as if it were an object of the new type:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> : <span class="keyword">public</span> A</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string s;</span><br><span class="line">    B b;</span><br><span class="line">    b.i = <span class="number">0</span>;</span><br><span class="line">    A* as = <span class="built_in">static_cast</span>&lt;A*&gt;(&amp;b);</span><br><span class="line">    A* ar = <span class="built_in">reinterpret_cast</span>&lt;A*&gt;(&amp;b);</span><br><span class="line">    B* c = <span class="built_in">reinterpret_cast</span>&lt;B*&gt;(ar);</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;as-&gt;i = &quot;</span> &lt;&lt; hex &lt;&lt; <span class="built_in">setfill</span>(<span class="string">&#x27;0&#x27;</span>)  &lt;&lt; as-&gt;i &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;ar-&gt;i = &quot;</span> &lt;&lt; ar-&gt;i &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;b.i   = &quot;</span> &lt;&lt; b.i &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;c-&gt;i  = &quot;</span> &lt;&lt; c-&gt;i &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;&amp;(as-&gt;i) = &quot;</span> &lt;&lt; &amp;(as-&gt;i) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;&amp;(ar-&gt;i) = &quot;</span> &lt;&lt; &amp;(ar-&gt;i) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;&amp;(b.i) = &quot;</span> &lt;&lt; &amp;(b.i) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;&amp;(c-&gt;i) = &quot;</span> &lt;&lt; &amp;(c-&gt;i) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;&amp;b = &quot;</span> &lt;&lt; &amp;b &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;as = &quot;</span> &lt;&lt; as &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;ar = &quot;</span> &lt;&lt; ar &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;c  = &quot;</span> &lt;&lt; c  &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Press ENTER to exit.\n&quot;</span>;</span><br><span class="line">    <span class="built_in">getline</span>(cin,s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Which results in output like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">as-&gt;i = 0</span><br><span class="line">ar-&gt;i = 50ee64</span><br><span class="line">b.i   = 0</span><br><span class="line">c-&gt;i  = 0</span><br><span class="line"></span><br><span class="line">&amp;(as-&gt;i) = 00EFF978</span><br><span class="line">&amp;(ar-&gt;i) = 00EFF974</span><br><span class="line">&amp;(b.i)   = 00EFF978</span><br><span class="line">&amp;(c-&gt;i)  = 00EFF978</span><br><span class="line"></span><br><span class="line">&amp;b = 00EFF974</span><br><span class="line">as = 00EFF978</span><br><span class="line">ar = 00EFF974</span><br><span class="line">c  = 00EFF974</span><br><span class="line">Press ENTER to exit.</span><br></pre></td></tr></table></figure>
<p>It can be seen that the B object is built in memory as B-specific data first, followed by the embedded A object. The static_cast correctly returns the address of the embedded A object, and the pointer created by static_cast correctly gives the value of the data field. The pointer generated by reinterpret_cast treats b’s memory location as if it were a plain A object, and so when the pointer tries to get the data field it returns some B-specific data as if it were the contents of this field.</p>
<p>应用如下：<br>下面的应用根据输入的类型T判断后使用了reinterpret_cast去转换；</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">OptionManager::RegisterOption</span><span class="params">(<span class="type">const</span> std::string&amp; name, <span class="type">const</span> T* option)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (std::is_same&lt;T, <span class="type">bool</span>&gt;::value) &#123;</span><br><span class="line">    options_bool_.<span class="built_in">emplace_back</span>(name, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">bool</span>*&gt;(option));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (std::is_same&lt;T, <span class="type">int</span>&gt;::value) &#123;</span><br><span class="line">    options_int_.<span class="built_in">emplace_back</span>(name, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">int</span>*&gt;(option));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (std::is_same&lt;T, <span class="type">double</span>&gt;::value) &#123;</span><br><span class="line">    options_double_.<span class="built_in">emplace_back</span>(name, <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">double</span>*&gt;(option));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (std::is_same&lt;T, std::string&gt;::value) &#123;</span><br><span class="line">    options_string_.<span class="built_in">emplace_back</span>(name,</span><br><span class="line">                                 <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> std::string*&gt;(option));</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">LOG</span>(FATAL) &lt;&lt; <span class="string">&quot;Unsupported option type&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xychen5</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
